<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alfabeto Aventura: Edici√≥n S√∫per Lector</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'cartoon': ['Bangers', 'cursive'],
                        'body': ['Fredoka', 'sans-serif'],
                    },
                    colors: {
                        'pastel-blue': '#A2D2FF',
                        'pastel-pink': '#FFC8DD',
                        'pastel-yellow': '#FFE5B4',
                        'pastel-green': '#CDEAC0',
                        'pastel-purple': '#DCD3FF',
                    }
                }
            }
        }
    </script>

    <style>
        /* --- ESTILOS GLOBALES Y ANIMACIONES DE FONDO --- */
        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(135deg, #e0f7fa, #e1bee7, #fff9c4, #ffe0b2);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            overflow-x: hidden;
            touch-action: manipulation; /* Mejora respuesta t√°ctil */
            -webkit-tap-highlight-color: transparent;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- NEUMORFISMO Y TARJETAS --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border-radius: 2.5rem;
            border: 2px solid rgba(255, 255, 255, 0.9);
            box-shadow: 
                20px 20px 60px rgba(0, 0, 0, 0.1),
                -20px -20px 60px rgba(255, 255, 255, 0.8);
        }

        /* --- BOTONES DEL MEN√ö (Estilo solicitado: Cuadrado, Pastel, Redondeado) --- */
        .menu-btn {
            aspect-ratio: 1 / 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 1.75rem; /* Bordes muy redondeados */
            border: none;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            /* Sombra suave "elevada" */
            box-shadow: 
                8px 8px 16px rgba(163, 177, 198, 0.4), 
                -8px -8px 16px rgba(255, 255, 255, 0.8),
                inset 0 0 0 transparent; 
        }

        /* Efecto al presionar (Hundimiento) */
        .menu-btn:active {
            transform: scale(0.96);
            box-shadow: 
                inset 6px 6px 10px rgba(163, 177, 198, 0.3), 
                inset -6px -6px 10px rgba(255, 255, 255, 0.8);
        }

        .menu-btn-icon {
            font-size: clamp(3rem, 8vw, 4.5rem);
            margin-bottom: 0.5rem;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.1));
            transition: transform 0.3s;
        }
        
        .menu-btn:hover .menu-btn-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .menu-btn-text {
            font-family: 'Bangers', cursive;
            font-size: clamp(1.2rem, 3vw, 1.6rem);
            color: #4a5568;
            letter-spacing: 1px;
            text-align: center;
            line-height: 1.1;
            text-shadow: 1px 1px 0px rgba(255,255,255,0.5);
        }

        /* Variantes de Color Pastel */
        .pastel-blue { background-color: #BFDBFE; color: #1E40AF; }
        .pastel-green { background-color: #BBF7D0; color: #166534; }
        .pastel-pink { background-color: #FBCFE8; color: #9D174D; }
        .pastel-yellow { background-color: #FEF08A; color: #854D0E; }
        .pastel-purple { background-color: #E9D5FF; color: #6B21A8; }
        .pastel-orange { background-color: #FED7AA; color: #9A3412; }

        /* --- BOTONES DE JUEGO & UI --- */
        .action-btn {
            border-radius: 1.5rem;
            font-family: 'Bangers', cursive;
            letter-spacing: 1.5px;
            box-shadow: 0 6px 0 rgba(0,0,0,0.2);
            transition: all 0.1s;
        }
        .action-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
        }

        /* --- TEXTOS FLUIDOS --- */
        .big-text {
            font-family: 'Bangers', cursive;
            /* Gradiente de texto */
            background: linear-gradient(to bottom, #4f46e5, #9333ea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(2px 2px 0px rgba(255,255,255,0.8));
        }

        /* --- ANIMACIONES ESPEC√çFICAS --- */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-6px, 0, 0); }
            40%, 60% { transform: translate3d(6px, 0, 0); }
        }

        .pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        .merge-center { animation: mergeCenter 1s forwards; }
        @keyframes mergeCenter {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(0); opacity: 0; width: 0; margin: 0; padding: 0;}
        }

        /* --- PARTICULAS --- */
        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 9999;
            animation: fly 1s ease-out forwards;
        }
        @keyframes fly {
            0% { transform: translate(0, 0) scale(1) rotate(0deg); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0) rotate(180deg); opacity: 0; }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Contenedor de Part√≠culas Global -->
    <div id="particles-container" class="fixed inset-0 pointer-events-none overflow-hidden z-50"></div>

    <!-- MAIN APP CONTAINER -->
    <div class="glass-panel w-full max-w-2xl relative flex flex-col min-h-[85vh] md:min-h-[600px] p-6 md:p-8 transition-all duration-500">
        
        <!-- HEADER -->
        <header class="flex flex-col items-center justify-center mb-6 relative z-10">
            <h1 class="font-cartoon text-5xl md:text-7xl text-indigo-600 tracking-wider drop-shadow-sm text-center leading-none" id="main-title">
                ALFABETO<br><span class="text-purple-500 text-4xl md:text-6xl">AVENTURA</span>
            </h1>
            <p id="subtitle" class="text-gray-500 font-bold mt-2 text-lg opacity-80 uppercase tracking-widest">Aprende jugando</p>
            
            <!-- Bot√≥n Home (Visible solo fuera del men√∫) -->
            <button id="home-btn" onclick="goHome()" class="hidden absolute top-0 left-0 bg-white p-2 rounded-full shadow-md hover:scale-110 transition text-2xl border-2 border-indigo-100 text-indigo-500">
                üè†
            </button>
        </header>

        <!-- CONTENIDO DIN√ÅMICO -->
        <main id="app-content" class="flex-grow flex flex-col relative">
            
            <!-- 1. MEN√ö PRINCIPAL (Grid Responsive) -->
            <div id="view-menu" class="view-section w-full h-full flex flex-col justify-center">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-6 p-2">
                    <!-- Fila 1 -->
                    <button class="menu-btn pastel-blue" onclick="startGame('flashcard', 'alphabet')">
                        <span class="menu-btn-icon">üÉè</span>
                        <span class="menu-btn-text">EXPLORA<br>LETRAS</span>
                    </button>
                    <button class="menu-btn pastel-green" onclick="startGame('quiz', 'alphabet')">
                        <span class="menu-btn-icon">üß©</span>
                        <span class="menu-btn-text">RETO DE<br>IMAGEN</span>
                    </button>
                    <button class="menu-btn pastel-purple" onclick="startSoundboard('alphabet')">
                        <span class="menu-btn-icon">üéπ</span>
                        <span class="menu-btn-text">PIANO<br>LETRAS</span>
                    </button>

                    <!-- Fila 2 -->
                    <button class="menu-btn pastel-pink" onclick="startGame('flashcard', 'syllables')">
                        <span class="menu-btn-icon">üîó</span>
                        <span class="menu-btn-text">EXPLORA<br>S√çLABAS</span>
                    </button>
                    <button class="menu-btn pastel-yellow" onclick="startGame('blending', 'blending-words')">
                        <span class="menu-btn-icon">üèóÔ∏è</span>
                        <span class="menu-btn-text">ARMA<br>PALABRAS</span>
                    </button>
                    <button class="menu-btn pastel-orange" onclick="startGame('path', 'blending-words')">
                        <span class="menu-btn-icon">üöÄ</span>
                        <span class="menu-btn-text">S√öPER<br>LECTOR</span>
                    </button>
                </div>

                <!-- Cr√©ditos (Bot√≥n discreto) -->
                <div class="mt-8 flex justify-center">
                    <button onclick="showCredits()" class="text-gray-400 font-bold text-sm hover:text-indigo-500 transition flex items-center gap-2 px-4 py-2 rounded-full border border-transparent hover:border-indigo-100 hover:bg-white/50">
                        ‚ÑπÔ∏è Cr√©ditos
                    </button>
                </div>
            </div>

            <!-- 2. VISTA DE JUEGO GEN√âRICA (Contenedor para Quiz, Flashcard, etc) -->
            <div id="view-game" class="view-section hidden w-full flex flex-col items-center">
                
                <!-- Barra de progreso / Puntuaci√≥n (Opcional) -->
                <div id="score-bar" class="hidden w-full flex justify-end mb-2">
                    <span class="bg-yellow-100 text-yellow-700 px-4 py-1 rounded-full font-bold shadow-sm border border-yellow-300">
                        ‚≠ê <span id="score-val">0</span>
                    </span>
                </div>

                <!-- Tarjeta de Contenido Principal -->
                <div id="game-card" class="bg-white w-full rounded-3xl p-6 shadow-xl border-4 border-indigo-50 relative min-h-[250px] flex flex-col items-center justify-center transition-all">
                    <!-- Instrucci√≥n -->
                    <h3 id="game-instruction" class="text-xl md:text-2xl text-gray-600 font-bold text-center mb-4"></h3>
                    
                    <!-- Display Principal (Letra, Palabra, S√≠labas) -->
                    <div id="game-display" class="flex flex-wrap justify-center items-center w-full mb-4">
                        <!-- El contenido se inyecta por JS -->
                    </div>

                    <!-- Feedback Visual -->
                    <div id="feedback-msg" class="h-8 text-xl font-bold text-center"></div>
                </div>

                <!-- √Årea de Interacci√≥n (Botones, Opciones) -->
                <div id="interaction-area" class="w-full mt-6 grid gap-4">
                    <!-- Botones de opciones o acciones se inyectan aqu√≠ -->
                </div>
                
                <!-- Bot√≥n Siguiente (Flotante o fijo) -->
                <button id="next-btn" class="hidden mt-6 bg-green-500 hover:bg-green-600 text-white w-full py-4 text-2xl action-btn rounded-2xl shadow-green-200">
                    Siguiente ‚û°
                </button>
            </div>

            <!-- 3. VISTA CR√âDITOS -->
            <div id="view-credits" class="view-section hidden w-full text-center">
                <div class="bg-indigo-50 p-6 rounded-3xl border-2 border-indigo-100">
                    <h2 class="font-cartoon text-3xl text-indigo-600 mb-4">Equipo de Desarrollo</h2>
                    <ul class="text-gray-600 space-y-2 font-medium">
                        <li>Samuel Alexander Reyes Iglesias</li>
                        <li>Ver√≥nica Yamileth Ram√≠rez</li>
                    </ul>
                    <hr class="border-indigo-200 my-4">
                    <p class="text-sm text-indigo-400">Universidad de El Salvador (UES)<br>Lic. Inform√°tica Educativa</p>
                </div>
                <button onclick="goHome()" class="mt-6 text-indigo-500 font-bold underline">Volver</button>
            </div>

        </main>
    </div>

    <!-- LOGICA JAVASCRIPT -->
    <script>
        // --- BASE DE DATOS ---
        const alphabetDB = [
            { display: 'A', word: 'Abeja', emoji: 'üêù' }, { display: 'B', word: 'Ballena', emoji: 'üê≥' },
            { display: 'C', word: 'Casa', emoji: 'üè†' }, { display: 'D', word: 'Dino', emoji: 'ü¶ñ' },
            { display: 'E', word: 'Elefante', emoji: 'üêò' }, { display: 'F', word: 'Flor', emoji: 'üå∏' },
            { display: 'G', word: 'Gato', emoji: 'üê±' }, { display: 'H', word: 'Huevo', emoji: 'ü•ö' },
            { display: 'I', word: 'Isla', emoji: 'üèùÔ∏è' }, { display: 'J', word: 'Jirafa', emoji: 'ü¶í' },
            { display: 'L', word: 'Le√≥n', emoji: 'ü¶Å' }, { display: 'M', word: 'Mono', emoji: 'üêí' },
            { display: 'N', word: 'Nube', emoji: '‚òÅÔ∏è' }, { display: 'O', word: 'Oso', emoji: 'üêª' },
            { display: 'P', word: 'Pato', emoji: 'ü¶Ü' }, { display: 'Q', word: 'Queso', emoji: 'üßÄ' },
            { display: 'R', word: 'Rat√≥n', emoji: 'üê≠' }, { display: 'S', word: 'Sol', emoji: '‚òÄÔ∏è' },
            { display: 'T', word: 'Tren', emoji: 'üöÇ' }, { display: 'U', word: 'Uvas', emoji: 'üçá' },
            { display: 'V', word: 'Vaca', emoji: 'üêÆ' }, { display: 'Z', word: 'Zorro', emoji: 'ü¶ä' }
        ];

        const syllableDB = [
            { display: 'MA', word: 'Mam√°', emoji: 'üë©' }, { display: 'PA', word: 'Pap√°', emoji: 'üë®' },
            { display: 'SA', word: 'Sapo', emoji: 'üê∏' }, { display: 'LA', word: 'L√°piz', emoji: '‚úèÔ∏è' },
            { display: 'MI', word: 'Miel', emoji: 'üçØ' }, { display: 'LO', word: 'Loro', emoji: 'ü¶ú' },
            { display: 'DA', word: 'Dado', emoji: 'üé≤' }, { display: 'ME', word: 'Mesa', emoji: 'ü™ë' }
        ];

        const wordsDB = [
            { word: 'MESA', syllables: ['ME', 'SA'], emoji: 'ü™ë', sentence: 'La mesa es roja.' },
            { word: 'PATO', syllables: ['PA', 'TO'], emoji: 'ü¶Ü', sentence: 'El pato nada feliz.' },
            { word: 'SOPA', syllables: ['SO', 'PA'], emoji: 'üçú', sentence: 'La sopa est√° rica.' },
            { word: 'LUNA', syllables: ['LU', 'NA'], emoji: 'üåô', sentence: 'La luna brilla.' },
            { word: 'DADO', syllables: ['DA', 'DO'], emoji: 'üé≤', sentence: 'Tira el dado.' },
            { word: 'OJO', syllables: ['O', 'JO'], emoji: 'üëÅÔ∏è', sentence: 'Cierra un ojo.' }
        ];

        // --- ESTADO GLOBAL ---
        let currentMode = '';
        let currentData = [];
        let currentItem = null;
        let score = 0;
        let audioCtx = null;
        let pathStep = 0; // Para S√∫per Lector

        // --- SISTEMA DE AUDIO (Oscilador Web Audio API) ---
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playSound(type) {
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;
            
            if (type === 'click') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'correct') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(500, now);
                osc.frequency.linearRampToValueAtTime(1000, now + 0.1);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.4);
                osc.start(now);
                osc.stop(now + 0.4);
            } else if (type === 'wrong') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            }
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'es-ES';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        // --- SISTEMA DE PART√çCULAS ---
        function spawnConfetti(element) {
            const rect = element.getBoundingClientRect();
            const center = { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };
            const container = document.getElementById('particles-container');

            for (let i = 0; i < 20; i++) {
                const p = document.createElement('div');
                p.classList.add('particle');
                p.innerHTML = ['‚≠ê', '‚ú®', 'üü°', 'üü£'][Math.floor(Math.random()*4)];
                p.style.fontSize = Math.random() * 20 + 10 + 'px';
                p.style.left = center.x + 'px';
                p.style.top = center.y + 'px';
                
                // Physics calculation
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 150 + 50;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;
                
                p.style.setProperty('--tx', `${tx}px`);
                p.style.setProperty('--ty', `${ty}px`);
                
                container.appendChild(p);
                setTimeout(() => p.remove(), 1000);
            }
        }

        // --- NAVEGACI√ìN ---
        function goHome() {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-menu').classList.remove('hidden');
            document.getElementById('home-btn').classList.add('hidden');
            document.getElementById('subtitle').textContent = "APRENDE JUGANDO";
            document.getElementById('game-card').className = "bg-white w-full rounded-3xl p-6 shadow-xl border-4 border-indigo-50 relative min-h-[250px] flex flex-col items-center justify-center transition-all"; // Reset styles
        }

        function showCredits() {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-credits').classList.remove('hidden');
        }

        function startGame(mode, datasetName) {
            playSound('click');
            currentMode = mode;
            score = 0;
            document.getElementById('score-val').textContent = score;

            // Selecci√≥n de datos
            if (datasetName === 'alphabet') currentData = [...alphabetDB];
            else if (datasetName === 'syllables') currentData = [...syllableDB];
            else if (datasetName === 'blending-words') currentData = [...wordsDB];
            
            // UI Update
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-game').classList.remove('hidden');
            document.getElementById('home-btn').classList.remove('hidden');
            document.getElementById('interaction-area').className = "w-full mt-6 grid gap-4"; // Reset grid

            // Setup espec√≠fico por modo
            if (mode === 'quiz') {
                document.getElementById('subtitle').textContent = "RETO DE IMAGEN";
                document.getElementById('score-bar').classList.remove('hidden');
                document.getElementById('interaction-area').classList.add('grid-cols-2');
                loadQuiz();
            } else if (mode === 'flashcard') {
                document.getElementById('subtitle').textContent = "TARJETAS FLASH";
                document.getElementById('score-bar').classList.add('hidden');
                document.getElementById('interaction-area').classList.add('grid-cols-1');
                loadFlashcard();
            } else if (mode === 'blending') {
                document.getElementById('subtitle').textContent = "ARMA PALABRAS";
                document.getElementById('score-bar').classList.add('hidden');
                document.getElementById('interaction-area').classList.add('grid-cols-1');
                loadBlending();
            } else if (mode === 'path') {
                document.getElementById('subtitle').textContent = "S√öPER LECTOR";
                document.getElementById('score-bar').classList.add('hidden');
                document.getElementById('interaction-area').classList.add('grid-cols-1');
                loadPath();
            }
        }

        // --- L√ìGICA DE JUEGOS ---

        // 1. QUIZ
        function loadQuiz() {
            document.getElementById('next-btn').classList.add('hidden');
            document.getElementById('feedback-msg').textContent = '';
            
            // Random Item
            currentItem = currentData[Math.floor(Math.random() * currentData.length)];
            
            // Instruction
            document.getElementById('game-instruction').textContent = "Encuentra la imagen para:";
            document.getElementById('game-display').innerHTML = `
                <div class="text-8xl md:text-9xl big-text cursor-pointer animate-bounce" onclick="speak('${currentItem.display}')">
                    ${currentItem.display}
                </div>
            `;
            speak(currentItem.display);

            // Options (1 correct + 3 random)
            let options = [currentItem];
            while(options.length < 4) {
                let r = currentData[Math.floor(Math.random() * currentData.length)];
                if (!options.includes(r)) options.push(r);
            }
            options.sort(() => Math.random() - 0.5);

            // Render Buttons
            const container = document.getElementById('interaction-area');
            container.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "bg-white border-2 border-indigo-100 rounded-2xl p-4 shadow-sm hover:shadow-md transition flex flex-col items-center justify-center h-32 md:h-40";
                btn.innerHTML = `<span class="text-5xl md:text-6xl mb-2">${opt.emoji}</span><span class="font-body text-gray-500 font-bold">${opt.word}</span>`;
                btn.onclick = () => checkQuiz(opt, btn);
                container.appendChild(btn);
            });
        }

        function checkQuiz(selected, btnElement) {
            if (selected === currentItem) {
                playSound('correct');
                score++;
                document.getElementById('score-val').textContent = score;
                document.getElementById('feedback-msg').innerHTML = `<span class="text-green-500">¬°Correcto! Es ${currentItem.word}</span>`;
                spawnConfetti(btnElement);
                btnElement.classList.add('bg-green-100', 'border-green-400');
                
                // Auto next
                setTimeout(loadQuiz, 1500);
            } else {
                playSound('wrong');
                btnElement.classList.add('bg-red-100', 'border-red-400', 'shake');
                speak("Intenta de nuevo");
                setTimeout(() => btnElement.classList.remove('shake'), 500);
            }
        }

        // 2. FLASHCARDS
        function loadFlashcard() {
            currentItem = currentData[Math.floor(Math.random() * currentData.length)];
            document.getElementById('game-instruction').textContent = "¬øQu√© es esto?";
            document.getElementById('next-btn').classList.remove('hidden');
            document.getElementById('next-btn').textContent = "Siguiente Tarjeta";
            document.getElementById('next-btn').onclick = () => { playSound('click'); loadFlashcard(); };

            // State 1: Only Letter
            const display = document.getElementById('game-display');
            display.innerHTML = `
                <div id="fc-front" class="text-8xl md:text-9xl big-text cursor-pointer transition-all duration-500">
                    ${currentItem.display}
                </div>
                <div id="fc-back" class="hidden flex-col items-center text-center pop-in">
                    <div class="text-7xl mb-2">${currentItem.emoji}</div>
                    <div class="text-3xl font-cartoon text-indigo-600">${currentItem.word}</div>
                </div>
            `;
            speak(currentItem.display);

            // Button Action
            const container = document.getElementById('interaction-area');
            container.innerHTML = `
                <button onclick="revealFlashcard()" class="bg-yellow-400 text-white font-cartoon text-xl py-3 rounded-xl shadow-lg action-btn">
                    üëÄ Ver Respuesta
                </button>
            `;
        }

        function revealFlashcard() {
            playSound('click');
            document.getElementById('fc-front').classList.add('hidden');
            document.getElementById('fc-back').classList.remove('hidden');
            document.getElementById('fc-back').classList.add('flex');
            speak(currentItem.word);
            spawnConfetti(document.getElementById('fc-back'));
        }

        // 3. S√öPER LECTOR (Path 5 Pasos) - FIX CR√çTICO DE RESPONSIVIDAD
        function loadPath() {
            currentItem = currentData[Math.floor(Math.random() * currentData.length)];
            pathStep = 1;
            renderPathStep();
        }

        function renderPathStep() {
            const display = document.getElementById('game-display');
            const instruction = document.getElementById('game-instruction');
            const btnArea = document.getElementById('interaction-area');
            const nextBtn = document.getElementById('next-btn');
            nextBtn.classList.add('hidden'); // Ocultar bot√≥n gen√©rico

            // Resetear estilos de contenedor para evitar cortes
            display.className = "flex flex-wrap justify-center items-center w-full mb-4 gap-2 md:gap-4 min-h-[150px]";

            let htmlContent = '';
            let btnText = '';
            let instructionText = '';

            if (pathStep === 1) {
                // Paso 1: Letras
                instructionText = "1. Conoce las Letras";
                currentItem.word.split('').forEach(l => {
                    htmlContent += `<span class="text-5xl md:text-7xl font-cartoon text-gray-300 mx-1 animate-pulse">${l}</span>`;
                });
                btnText = "Ver S√≠labas";
                speak(currentItem.word.split('').join(' '));
            } 
            else if (pathStep === 2) {
                // Paso 2: S√≠labas
                instructionText = "2. Lee las S√≠labas";
                currentItem.syllables.forEach(s => {
                    htmlContent += `<span class="bg-blue-100 text-blue-600 px-4 py-2 rounded-xl text-4xl md:text-6xl font-cartoon border-2 border-blue-200">${s}</span>`;
                });
                btnText = "¬°Unir Palabras!";
                speak(currentItem.syllables.join('... '));
            }
            else if (pathStep === 3) {
                // Paso 3: Uni√≥n (Blending) - FIX VISUAL
                instructionText = "3. ¬°Uni√≥n M√°gica!";
                // Contenedor flexible que asegura que no se salga de la tarjeta
                htmlContent = `
                    <div id="syllable-container" class="flex flex-wrap justify-center items-center gap-4 transition-all duration-1000 w-full">
                         ${currentItem.syllables.map(s => `<div class="syllable-pill bg-red-100 text-red-600 px-4 py-3 rounded-2xl text-4xl md:text-6xl font-cartoon shadow-md border-b-4 border-red-200">${s}</div>`).join('')}
                    </div>
                    <div id="final-word" class="hidden text-6xl md:text-8xl big-text pop-in">${currentItem.word}</div>
                `;
                btnText = "Revelar Imagen";
            }
            else if (pathStep === 4) {
                // Paso 4: Imagen
                instructionText = "4. ¬°Palabra e Imagen!";
                htmlContent = `
                    <div class="flex flex-col items-center">
                        <div class="text-8xl md:text-9xl mb-2 drop-shadow-md animate-bounce">${currentItem.emoji}</div>
                        <div class="text-5xl md:text-6xl font-cartoon text-indigo-600">${currentItem.word}</div>
                    </div>
                `;
                btnText = "Ver Frase";
                speak(currentItem.word);
            }
            else if (pathStep === 5) {
                // Paso 5: Frase
                instructionText = "5. ¬°Lectura Experta!";
                htmlContent = `
                    <div class="bg-yellow-50 p-6 rounded-2xl border-2 border-yellow-200 text-center max-w-full">
                        <p class="text-2xl md:text-4xl font-body text-gray-700 leading-relaxed">
                            "${currentItem.sentence}"
                        </p>
                    </div>
                `;
                btnText = "¬°Otra Palabra!";
                speak(currentItem.sentence);
            }

            display.innerHTML = htmlContent;
            instruction.textContent = instructionText;

            // Renderizar bot√≥n de acci√≥n √∫nico
            btnArea.innerHTML = `
                <button id="path-action-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white w-full py-4 text-2xl action-btn rounded-2xl shadow-indigo-300">
                    ${btnText}
                </button>
            `;

            document.getElementById('path-action-btn').onclick = advancePath;
        }

        function advancePath() {
            playSound('click');
            
            if (pathStep === 3) {
                // Animaci√≥n especial de uni√≥n
                const container = document.getElementById('syllable-container');
                const word = document.getElementById('final-word');
                
                // Efecto de fusionar: Reducir gap y escala
                container.classList.add('scale-50', 'opacity-0');
                container.style.gap = '-50px';
                
                setTimeout(() => {
                    container.classList.add('hidden');
                    word.classList.remove('hidden');
                    playSound('correct');
                    spawnConfetti(word);
                    speak(currentItem.word);
                    
                    // Cambiar bot√≥n manualmente despu√©s de la animaci√≥n
                    setTimeout(() => {
                        pathStep++;
                        renderPathStep();
                    }, 1500);
                }, 500);
                
                // Deshabilitar bot√≥n temporalmente
                document.getElementById('path-action-btn').disabled = true;
                return;
            }

            if (pathStep < 5) {
                pathStep++;
                renderPathStep();
            } else {
                // Reiniciar con nueva palabra
                spawnConfetti(document.getElementById('game-card'));
                playSound('correct');
                setTimeout(loadPath, 1000);
            }
        }

        // 4. SOUNDBOARD (PIANO)
        function startSoundboard(type) {
            playSound('click');
            document.getElementById('subtitle').textContent = "PANEL DE SONIDOS";
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-game').classList.remove('hidden');
            document.getElementById('game-card').classList.add('hidden'); // Ocultar tarjeta principal
            document.getElementById('home-btn').classList.remove('hidden');

            const container = document.getElementById('interaction-area');
            container.className = "w-full grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3"; // Grid denso

            const data = type === 'alphabet' ? alphabetDB : syllableDB;

            container.innerHTML = '';
            data.forEach(item => {
                const btn = document.createElement('button');
                // Botones estilo "Teclado"
                btn.className = "bg-white h-24 rounded-2xl shadow-[0_4px_0_rgb(0,0,0,0.1)] active:shadow-none active:translate-y-1 transition border border-gray-100 flex flex-col items-center justify-center";
                btn.innerHTML = `
                    <span class="text-3xl font-cartoon text-indigo-500">${item.display}</span>
                    <span class="text-xl opacity-50 grayscale hover:grayscale-0">${item.emoji}</span>
                `;
                btn.onclick = () => {
                    playSound('click');
                    btn.classList.add('bg-indigo-50', 'border-indigo-300');
                    setTimeout(() => btn.classList.remove('bg-indigo-50', 'border-indigo-300'), 200);
                    speak(item.display);
                };
                container.appendChild(btn);
            });
        }

        // 5. ARMA PALABRAS (Blending Simplificado)
        function loadBlending() {
            currentItem = currentData[Math.floor(Math.random() * currentData.length)];
            
            document.getElementById('game-instruction').textContent = "Escucha y Construye:";
            document.getElementById('game-display').innerHTML = `
                <div id="blend-target" class="flex gap-2">
                    <!-- Espacios vac√≠os -->
                    ${currentItem.syllables.map(() => `<div class="w-20 h-20 border-4 border-dashed border-gray-300 rounded-xl flex items-center justify-center bg-gray-50">?</div>`).join('')}
                </div>
            `;
            
            speak(currentItem.word);

            // Generar opciones mezcladas
            let options = [...currentItem.syllables];
            // A√±adir distractores
            options.push('MA', 'LO', 'SA'); 
            options = options.slice(0, 5).sort(() => Math.random() - 0.5);

            const area = document.getElementById('interaction-area');
            area.className = "flex flex-wrap justify-center gap-4 mt-8";
            area.innerHTML = '';

            options.forEach(s => {
                const btn = document.createElement('button');
                btn.className = "bg-white text-indigo-600 font-cartoon text-3xl px-6 py-4 rounded-2xl shadow-md border-b-4 border-indigo-100 active:translate-y-1 active:border-b-0 transition";
                btn.textContent = s;
                btn.onclick = () => {
                    playSound('click');
                    speak(s);
                    // L√≥gica simple: Verificar si es parte de la palabra
                    if (currentItem.syllables.includes(s)) {
                        // Encontrar slot vac√≠o
                        const slots = document.getElementById('blend-target').children;
                        let found = false;
                        currentItem.syllables.forEach((syl, idx) => {
                            if (syl === s && slots[idx].textContent === '?') {
                                slots[idx].textContent = s;
                                slots[idx].className = "w-20 h-20 bg-green-100 border-4 border-green-400 rounded-xl flex items-center justify-center text-2xl font-bold text-green-700 animate-bounce";
                                playSound('correct');
                                btn.classList.add('opacity-0', 'pointer-events-none');
                                found = true;
                            }
                        });

                        // Verificar victoria
                        const allFilled = Array.from(slots).every(slot => slot.textContent !== '?');
                        if (allFilled) {
                            document.getElementById('game-instruction').textContent = "¬°MUY BIEN!";
                            spawnConfetti(document.getElementById('game-display'));
                            document.getElementById('next-btn').classList.remove('hidden');
                            document.getElementById('next-btn').onclick = loadBlending;
                            speak(currentItem.word);
                        }
                    } else {
                        playSound('wrong');
                        btn.classList.add('bg-red-100', 'shake');
                        setTimeout(() => btn.classList.remove('bg-red-100', 'shake'), 500);
                    }
                };
                area.appendChild(btn);
            });
        }

        // Iniciar en Men√∫
        window.onload = () => {
            // Animaci√≥n de entrada
            document.querySelector('.glass-panel').classList.add('pop-in');
        };

    </script>
</body>
</html>
